; Supervisor 配置文件
; 安装: apt-get install supervisor (Ubuntu/Debian)
; 或: yum install supervisor (CentOS/RHEL)
; 
; 配置文件位置: /etc/supervisor/conf.d/whisper-api.conf
; 管理命令:
;   supervisorctl reread
;   supervisorctl update
;   supervisorctl start whisper-api:*
;   supervisorctl status

[program:whisper-api]
command=/opt/conda/envs/whisper-api/bin/gunicorn -c /opt/whisperTest/gunicorn_config.py api:api_app
directory=/opt/whisperTest
user=www-data
autostart=true
autorestart=true
startretries=3
stderr_logfile=/opt/whisperTest/logs/api_supervisor_error.log
stdout_logfile=/opt/whisperTest/logs/api_supervisor.log
environment=PATH="/opt/conda/bin:/opt/conda/envs/whisper-api/bin"
# 如果使用 venv，取消注释下面这行并注释上面的 environment
# environment=PATH="/opt/whisperTest/venv/bin"
stopasgroup=true
killasgroup=true

[program:whisper-gradio]
command=/opt/conda/envs/whisper-api/bin/python /opt/whisperTest/run_gradio_production.py
directory=/opt/whisperTest
user=www-data
autostart=true
autorestart=true
startretries=3
stderr_logfile=/opt/whisperTest/logs/gradio_supervisor_error.log
stdout_logfile=/opt/whisperTest/logs/gradio_supervisor.log
environment=PATH="/opt/conda/bin:/opt/conda/envs/whisper-api/bin"
# 如果使用 venv，取消注释下面这行并注释上面的 environment
# environment=PATH="/opt/whisperTest/venv/bin"
stopasgroup=true
killasgroup=true

[group:whisper-services]
programs=whisper-api,whisper-gradio
priority=999

